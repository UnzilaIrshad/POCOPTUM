name: Deploy Azure Function with ARM Template

on:
  workflow_dispatch:

env:
  AZURE_SUBSCRIPTION_ID: ${{ secrets.SUBSCRIPTIONID }}
  RESOURCE_GROUP: DynamicsDeployments-eastus
  LOCATION: Central US
  FUNCTION_APP_NAME: FunctionAppDeployment-Unzila

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Azure CLI
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    - name: Deploy ARM Template
      run: |
        az deployment group create \
          --subscription ${{ env.AZURE_SUBSCRIPTION_ID }} \
          --resource-group ${{ env.RESOURCE_GROUP }} \
          --template-file FunctionTemplates/templateFunction.json \
          --parameters sites_FunctionAppDeploymentPOCTest_name=${{ env.FUNCTION_APP_NAME }} \
                      serverfarms_FunctionAppDeploymentPOCTest_externalid=${{ secrets.APP_SERVICE_PLAN_ID }}
